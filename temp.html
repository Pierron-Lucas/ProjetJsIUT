<!doctype html>
<html lang="fr">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capteur</title>


    <meta name="theme-color" content="#ffffff">

</head>

<body>
    <h1> Valeur : </h1>
    <p id='status'></p>
    <code id='datas'></code>
    <button id='notifications'> Notification</button>
    <h2>Notifications</h2>
    <button id="notifications">Notifications</button>
    <script> socket = new WebSocket("wss://ws.hothothot.dog:9502");
        socket.onopen = function (event) {
            console.log("Connexion établie");

            //On indique sur notre page web que la connexion est établie
            let label = document.getElementById("status");
            label.innerHTML = "Connexion établie";

            //Envoi d'un message au serveur (obligatoire)
            socket.send("coucou !");

            // au retour...
            socket.onmessage = function (event) {
                var datas = document.getElementById("datas");
                datas.innerHTML = event.data;
                var json = JSON.parse(event.data);
                console.log(json.capteurs[0].Valeur);


            }
        }
        function getSensors(){
            return 0;
        }
        function getRandomInt(max) {
            return Math.floor(Math.random() * Math.floor(max));
        }

        function randomNotification() {
            var randomNumber = getSensors();
            console.log(randomNumber);
            if (randomNumber >= 2) {

                var notifTitle = "Chaud, non ?";
                var notifBody = 'Température : ' + randomNumber + '.';
                var notifImg = '/assets/images/android-chrome-192x192.png';
                var options = {
                    body: notifBody,
                    icon: notifImg
                }
                var notif = new Notification(notifTitle, options);
            }
            else {
                var Title = "Il fait froid";
                var body = 'Température :' + randomNumber + '.';
                var img = '/assets/images/android-chrome-192x192.png';
                var opt = { body: body, icon: img }
                var notification = new Notification(Title, opt);
            }
            setTimeout(randomNotification, 30000);

        }
        var button = document.getElementById("notifications");
        button.addEventListener('click', function (e) {
            Notification.requestPermission().then(function (result) {
                if (result === 'granted') {
                    randomNotification();
                }
            });
        });
   /* capteur = '{"HotHotHot":"Api v1.0","capteurs":[{"type":"Thermique","Nom":"interieur","Valeur":"15.6","Timestamp":1646985511},{"type":"Thermique","Nom":"exterieur","Valeur":"10.6","Timestamp":1646985511}]}';
         var json = JSON.parse(capteur);
         console.log(typeof json.capteurs[0].Valeur);
         date = new Date(json.capteurs[0].Timestamp*1000);
         console.log(date);
         console.log(datas);*/
    </script>
    <script src="amuhome/b20016425/dossier/app.js"></script>
</body>

</html>